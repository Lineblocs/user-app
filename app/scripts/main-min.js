"use strict";function checkExpires(e){}function getJWTTokenObj(){var e=localStorage.getItem("AUTH");return e?JSON.parse(e):""}function getJWTToken(){var e=getJWTTokenObj();return""!==e?"Bearer "+e.token.auth:""}function getWorkspaceID(){return JSON.parse(localStorage.getItem("WORKSPACE")).id}window.app_version=2;var check1=document.location.href.includes("http://localhost"),check2=document.location.href.includes("ngrok.io");if(check1||check2)var baseUrl="https://lineblocs.com/api";else baseUrl="/api";function createUrl(e){return baseUrl+e}function generatePassword(){for(var e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",t="",o=0,n=e.length;o<32;++o)t+=e.charAt(Math.floor(Math.random()*n));return t}function formatDate(e,t){var o="YYYY-MM-DD";return(t=t||!1)&&(o+=" HH:mm:ss"),e?moment(e).format(o):""}angular.module("MaterialApp",["ui.router","ngAnimate","ngMaterial","chart.js","pascalprecht.translate","md.data.table","ngIdle","ngclipboard"]).service("JWTHttpInterceptor",function(){return{request:function(e){return localStorage.getItem("AUTH")&&(e.headers.Authorization=getJWTToken()),localStorage.getItem("WORKSPACE")&&(e.headers["X-Workspace-ID"]=getWorkspaceID()),console.log("request headers are ",e.headers),e}}}).factory("$shared",function(e,t,o,n,a,r,i){var s=this;s.initialLoaded=!1,s.title="LineBlocs.com",s.FLOW_EDITOR_URL="https://editor.lineblocs.com",s.SHOW_NAVBAR=!0,s.PAGE_CONTENT_NO_PADDING=!1,s.isLoading=!0,s.currentWorkspace="",s.billingCountries=[{iso:"CA",name:"Canada"},{iso:"US",name:"United States"}],s.billingPackages=["gold","silver","bronze"];return s.showToast=function(e,t){t=t||"top right";i.show(i.simple().textContent(e).position(t).hideDelay(3e3))},s.endIsLoading=function(){return n(function(e,t){o(function(){s.isLoading=!1,e()},0)})},s.endIsCreateLoading=function(){return n(function(e,t){o(function(){s.isCreateLoading=!1,e()},0)})},s.scrollToTop=function(){a.scrollTo(0,0)},s.changeRoute=function(t,n){console.log("changeRoute called ",arguments);n=n||{};s.state&&s.state.name===t||(["flow-editor"].includes(t)||(s.isLoading=!0),e.go(t,n),o(function(){},0))},s.collapseNavbar=function(){s.SHOW_NAVBAR=!1,s.PAGE_CONTENT_NO_PADDING=!0,$(".c-hamburger").removeClass("is-active"),$("body").removeClass("extended")},s.processResult=function(){var e=r.search();e.result&&"email-verified"===e.result&&i.show(i.simple().textContent("Email was verified").position("top right").hideDelay(3e3))},s.showNavbar=function(){s.SHOW_NAVBAR=!0,s.PAGE_CONTENT_NO_PADDING=!1,$(".c-hamburger").addClass("is-active"),$("body").addClass("extended")},s.doLogout=function(){s.purgeSession(),e.go("login",{})},s.setAuthToken=function(e){localStorage.setItem("AUTH",JSON.stringify(e))},s.getAuthToken=function(){return JSON.parse(localStorage.getItem("AUTH"))},s.setWorkspace=function(e){localStorage.setItem("WORKSPACE",JSON.stringify(e))},s.getWorkspace=function(e){return JSON.parse(localStorage.getItem("WORKSPACE"))},s.purgeSession=function(){localStorage.removeItem("WORKSPACE"),localStorage.removeItem("AUTH")},s.canPerformAction=function(e){return!!s.getWorkspace().user_info[e]},s.has=function(){return JSON.parse(localStorage.getItem("WORKSPACE"))},s.showError=function(e,o){s.changingPage=!1,s.endIsCreateLoading(),s.endIsLoading(),t.show(t.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title(e).textContent(o).ariaLabel(e).ok("Ok"))},s.updateTitle=function(e){s.title="LineBlocs.com",e&&(s.title="LineBlocs.com - "+e)},s.scrollTop=function(){a.scrollTo(0,0)},s.makeDefaultWorkspaceRoles=function(e){if(!e)return{manage_users:!1,manage_extensions:!1,create_extension:!1,manage_billing:!1,manage_workspace:!1,manage_dids:!1,create_did:!1,manage_calls:!1,manage_recordings:!1,manage_blocked_numbers:!1,manage_ip_whitelist:!1,manage_verified_caller_ids:!1,create_flow:!1,manage_flows:!1};var t=[];return t.push({id:"manage_users",name:"Manage Users",info:"Allow this user to create, read, update or delete other users in your workspace"}),t.push({id:"manage_extensions",name:"Manage Extensions",info:"Allow this user to create, read, update or delete other extensions in your workspace"}),t.push({id:"create_extension",name:"Create Extension",info:"Allow this user to create an extension"}),t.push({id:"manage_billing",name:"Manage Billing",info:"Allow this user to manage used credit cards, payment options, usage limits and advanced billing settings"}),t.push({id:"manage_workspace",name:"Manage Workspace",info:"Allow this user to manage workspace settings"}),t.push({id:"manage_dids",name:"Manage DIDs",info:"Allow this user to buy and manage DIDs"}),t.push({id:"create_did",name:"Create DID",info:"Allow this user to buy a DID"}),t.push({id:"manage_calls",name:"Manage Calls",info:"Allow this user to manage calls"}),t.push({id:"manage_recordings",name:"Manage Recordings",info:"Allow this user to manage recordings"}),t.push({id:"manage_blocked_numbers",name:"Manage Blocked Numbers",info:"Allow this user to manage blocked numbers"}),t.push({id:"manage_ip_whitelist",name:"Manage IP Whitelist",info:"Allow this user to manage IP whitelist"}),t.push({id:"manage_verified_caller_ids",name:"Manage Verified Caller IDs",info:"Allow this user to manage verified caller ids"}),t.push({id:"manage_flows",name:"Manage Flows",info:"Allow this user to manage flows"}),t.push({id:"create_flow",name:"Create Flow",info:"Allow this user to create flows"}),t},s}).factory("Backend",function(e,t,o){var n=this;function a(e,t){if(console.log("erroHandler ",arguments),t)return e=e||"An error occured.",void o.showError(e);o.showError("An error occured.")}return n.getJWTToken=function(o,n){var a={email:o,password:n};return t(function(t,o){e.post(createUrl("/jwt/authenticate"),a).then(function(e){localStorage.setItem("AUTH",JSON.stringify(e.data.jwt)),localStorage.setItem("WORKSPACE",JSON.stringify(e.data.workspace)),t()}).catch(function(e){o(e)})})},n.get=function(o,n,r){return t(function(t,i){e.get(createUrl(o),n).then(t,function(e){a(e.message,r),i(e)})})},n.getPagination=function(e,t){return e=e+"?page="+pagination.settings.currentPage,n.get(e,t)},n.delete=function(o,n){return t(function(t,r){e.delete(createUrl(o)).then(t,function(e){a(e.message,n),r(e)})})},n.post=function(o,n,r,i){return t(function(t,s){e.post(createUrl(o),n).then(t,function(e){var t=e.message;r||a(t,i),s(e)})})},n.postFiles=function(o,n,r){return t(function(t,i){e({url:createUrl(o),method:"POST",data:n,headers:{"Content-Type":void 0}}).then(t,function(e){console.log("postFiles result ",e),a(e.data.message,r),i(e)})})},n}).factory("pagination",function(e,t,o,n){var a=this;a.settings={search:"",args:{},currentPage:1,currentUrl:"",scope:{obj:null,key:""}},a.didSearch=!1,a.meta={};var r=null;return a.nextPage=function(){a.settings.currentPage=a.settings.currentPage+1,a.loadData()},a.prevPage=function(){a.settings.currentPage=a.settings.currentPage-1,a.loadData()},a.hasNext=function(){return console.log("hasNext meta is ",a.meta),a.settings.currentPage!==a.meta.pagination.total_pages&&0!==a.meta.pagination.total_pages&&(console.log("we have next"),!0)},a.hasPrev=function(){return 1!==a.settings.currentPage},a.changePage=function(e){a.settings.currentPage=e},a.changeUrl=function(e){a.settings.currentUrl=e},a.changeScope=function(e,t){a.settings.scope={obj:e,key:t}},a.loadData=function(){var n=a.settings.currentUrl+"?page="+a.settings.currentPage;for(var r in""!==a.settings.search&&(n+="&search="+encodeURIComponent(a.settings.search)),a.settings.args){var i=a.settings.args[r];""!==i&&i&&(n+="&"+r+"="+encodeURIComponent(i))}return t.isCreateLoading=!0,o(function(o,r){e.get(n).then(function(e){var n=e.data.meta;a.meta=n,a.settings.scope.obj[a.settings.scope.key]=e.data.data,t.endIsCreateLoading(),o(e)})})},a.gotoPage=function(e){a.changePage(e),a.loadData()},a.resetSearch=function(){r=null,a.settings.search="",a.didSearch=!1},a.search=function(){a.didSearch=!0,null!==r&&n.cancel(r),r=n(function(){a.loadData()},500)},a}).config(["$httpProvider","$locationProvider",function(e,t){e.interceptors.push("JWTHttpInterceptor")}]).config(function(e,t){e.idle(900),e.timeout(60),t.interval(600)}).config(function(e){e.useStaticFilesLoader({prefix:"languages/",suffix:".json"}),e.useSanitizeValueStrategy(null),e.preferredLanguage("en")}).config(function(e,t){t.when("/dashboard","/dashboard/home"),t.otherwise("/dashboard/home"),e.state("base",{abstract:!0,url:"",templateUrl:"views/base.html",controller:"DashboardCtrl"}).state("login",{url:"/login",parent:"base",templateUrl:"views/pages/login.html",controller:"LoginCtrl"}).state("register",{url:"/register",parent:"base",templateUrl:"views/pages/register.html",controller:"RegisterCtrl",params:{hasData:null,authData:null,userId:null}}).state("forgot",{url:"/forgot",parent:"base",templateUrl:"views/pages/forgot.html",controller:"ForgotCtrl"}).state("reset",{url:"/reset",parent:"base",templateUrl:"views/pages/reset.html",controller:"ResetCtrl"}).state("404",{url:"/404-page",parent:"base",templateUrl:"views/pages/404-page.html"}).state("dashboard",{url:"/dashboard",parent:"base",templateUrl:"views/layouts/dashboard.html",controller:"DashboardCtrl"}).state("dashboard-user-welcome",{url:"/welcome",parent:"dashboard",templateUrl:"views/pages/dashboard-welcome.html",controller:"DashboardWelcomeCtrl"}).state("my-numbers",{url:"/dids/my-numbers",parent:"dashboard",templateUrl:"views/pages/did/my-numbers.html",controller:"MyNumbersCtrl"}).state("my-numbers-edit",{url:"/dids/my-numbers/{numberId}/edit",parent:"dashboard",templateUrl:"views/pages/did/my-numbers-edit.html",controller:"MyNumbersEditCtrl"}).state("buy-numbers",{url:"/dids/buy-numbers",parent:"dashboard",templateUrl:"views/pages/did/buy-numbers.html",controller:"BuyNumbersCtrl"}).state("ports",{url:"/dids/ports",parent:"dashboard",templateUrl:"views/pages/did/ports/numbers.html",controller:"PortNumbersCtrl"}).state("port-create",{url:"/dids/ports/create",parent:"dashboard",templateUrl:"views/pages/did/ports/create-port.html",controller:"CreatePortCtrl"}).state("port-edit",{url:"/dids/ports/{numberId}/edit",parent:"dashboard",templateUrl:"views/pages/did/ports/edit-port.html",controller:"EditPortCtrl"}).state("flows",{url:"/flows",parent:"dashboard",templateUrl:"views/pages/flows.html",controller:"FlowsCtrl"}).state("flow-editor",{url:"/flows/{flowId}",parent:"dashboard",templateUrl:"views/pages/flow-editor.html",controller:"FlowEditorCtrl"}).state("extensions",{url:"/extensions",parent:"dashboard",templateUrl:"views/pages/extensions.html",controller:"ExtensionsCtrl"}).state("extension-create",{url:"/extension/create",parent:"dashboard",templateUrl:"views/pages/extension-create.html",controller:"ExtensionCreateCtrl"}).state("extension-edit",{url:"/extension/{extensionId}/edit",parent:"dashboard",templateUrl:"views/pages/extension-edit.html",controller:"ExtensionEditCtrl"}).state("debugger-logs",{url:"/debugger-logs",parent:"dashboard",templateUrl:"views/pages/debugger-logs.html",controller:"DebuggerLogsCtrl"}).state("debugger-log-view",{url:"/debugger-logs/{logId}/view",parent:"dashboard",templateUrl:"views/pages/log-view.html",controller:"DebuggerLogViewCtrl"}).state("calls",{url:"/calls",parent:"dashboard",templateUrl:"views/pages/calls.html",controller:"CallsCtrl"}).state("call-view",{url:"/call/{callId}/view",parent:"dashboard",templateUrl:"views/pages/call-view.html",controller:"CallViewCtrl"}).state("recordings",{url:"/recordings",parent:"dashboard",templateUrl:"views/pages/recordings.html",controller:"RecordingsCtrl"}).state("faxes",{url:"/faxes",parent:"dashboard",templateUrl:"views/pages/faxes.html",controller:"FaxesCtrl"}).state("billing",{url:"/billing",parent:"dashboard",templateUrl:"views/pages/billing.html",controller:"BillingCtrl"}).state("billing-add-card",{url:"/billing/add-card",parent:"dashboard",templateUrl:"views/pages/billing-add-card.html",controller:"BillingCtrl"}).state("home",{url:"/home",parent:"dashboard",templateUrl:"views/pages/dashboard/home.html",controller:"HomeCtrl"}).state("settings",{url:"/settings",parent:"dashboard",templateUrl:"views/pages/settings.html",controller:"SettingsCtrl"}).state("settings-verified-callerids",{url:"/settings/verified-callerids",parent:"dashboard",templateUrl:"views/pages/settings/verified-callerids.html",controller:"VerifiedCallerIdsCtrl"}).state("settings-verified-callerids-create",{url:"/settings/verified-callerids/create",parent:"dashboard",templateUrl:"views/pages/settings/verified-callerids-create.html",controller:"VerifiedCallerIdsCreateCtrl"}).state("settings-blocked-numbers",{url:"/settings/blocked-numbers",parent:"dashboard",templateUrl:"views/pages/settings/blocked-numbers.html",controller:"BlockedNumbersCtrl"}).state("settings-blocked-numbers-create",{url:"/settings/blocked-numbers/create",parent:"dashboard",templateUrl:"views/pages/settings/blocked-numbers-create.html",controller:"BlockedNumbersCreateCtrl"}).state("settings-ip-whitelist",{url:"/settings/ip-whitelist",parent:"dashboard",templateUrl:"views/pages/settings/ip-whitelist.html",controller:"IpWhitelistCtrl"}).state("settings-workspace-users",{url:"/settings/workspace-users",parent:"dashboard",templateUrl:"views/pages/settings/workspace-users.html",controller:"WorkspaceUserCtrl"}).state("settings-workspace-api-settings",{url:"/settings/workspace-api-settings",parent:"dashboard",templateUrl:"views/pages/settings/workspace-api-settings.html",controller:"WorkspaceAPISettingsCtrl"}).state("settings-workspace-params",{url:"/settings/workspace-params",parent:"dashboard",templateUrl:"views/pages/settings/workspace-params.html",controller:"WorkspaceParamCtrl"}).state("settings-workspace-users-create",{url:"/settings/workspace-users/create",parent:"dashboard",templateUrl:"views/pages/settings/workspace-users-create.html",controller:"WorkspaceUserCreateCtrl"}).state("settings-workspace-users-edit",{url:"/settings/workspace-users/{userId}/edit",parent:"dashboard",templateUrl:"views/pages/settings/workspace-users-edit.html",controller:"WorkspaceUserEditCtrl"}).state("settings-extension-codes",{url:"/settings/extension-codes",parent:"dashboard",templateUrl:"views/pages/settings/extension-codes.html",controller:"ExtensionCodesCtrl"}).state("files",{url:"/files",parent:"dashboard",templateUrl:"views/pages/files.html",controller:"FilesCtrl"}).state("blank",{url:"/blank",parent:"dashboard",templateUrl:"views/pages/dashboard/blank.html"})}).run(function(e,t){e.$on("IdleStart",function(){}),e.$on("IdleTimeout",function(){t.doLogout()}),e.$on("$stateChangeStart",function(e,o,n,a,r){console.log("state is changing ",arguments),t.state=o,t.showNavbar()})}),angular.module("MaterialApp").controller("BillingCtrl",function(e,t,o,n,a,r,i,s,l,u){function d(e,t,o,n){e.$shared=o,e.data={percentage:"10%"},e.percentages=[];for(var r=10;r<=90;)e.percentages.push(r.toString()+"%"),r+=10;e.close=function(){t.hide()},e.save=function(){var t=angular.copy(e.data);a.post("/addUsageTrigger",t).then(function(t){e.close(),n()})}}function c(t,o){var n={};n.card_id=t,n.amount=o,e.data.creditAmount.value,r.isCreateLoading=!0,a.post("/credit/addCredit",n).then(function(e){console.log("added credit amount"),f(!0).then(function(){s.show(s.simple().textContent("Added credits successfully").position("top right").hideDelay(3e3))})})}function g(e){return n(function(t,o){var n={};n.stripe_token=e.id,n.stripe_card=e.card.id,n.last_4=e.card.last4,n.issuer=e.card.brand,r.isCreateLoading=!0,a.post("/card/addCard",n).then(function(e){t(e),r.endIsCreateLoading()},function(e){console.error("an error occured ",e)})})}function p(e,t,o,n,a,r){function i(a,r){t(function(){e.$apply(),r.error?e.errorMsg=r.error.message:(o.hide(),n(r))},0)}e.$shared=r,e.card={name:"",address:"",city:"",postal_code:"",number:"",expires:"",cvv:""},e.cancel=function(){o.cancel()},e.submit=function(){var t={};t.number=e.card.number,t.cvc=e.card.cvv;var o=e.card.expires.split("/");t.exp_month=o[0],t.exp_year=o[1],t.address_zip=e.card.postal_code,Stripe.card.createToken(t,i)}}function m(){return a.get("/getBillingHistory?startDate="+formatDate(e.startDate,!0)+"&endDate="+formatDate(e.endDate,!0))}function f(t){return t?r.isCreateLoading=!0:r.isLoading=!0,n(function(o,i){n.all([a.get("/billing"),m()]).then(function(n){console.log("finished loading.."),e.billing=n[0].data[0],e.settings.db=n[0].data[0].info.settings;var a=parseFloat(e.settings.db.auto_recharge_top_up_dollars);if(e.settings.db.auto_recharge_top_up)for(var i in e.creditAmounts){var s=e.creditAmounts[i];console.log("comparing amount ",s,a),s.value===a&&(e.settings.db.auto_recharge_top_up=s)}e.cards=n[0].data[1],e.config=n[0].data[2],e.usageTriggers=n[0].data[4],e.history=n[1].data,console.log("config is ",e.config),Stripe.setPublishableKey(e.config.stripe.key),console.log("billing data is ",e.billing),console.log("cards are ",e.cards),console.log("settings are ",e.settings),console.log("usage triggers are ",e.usageTriggers),e.creditAmount=e.creditAmounts[0],t?r.endIsCreateLoading():r.endIsLoading(),o()},i)})}r.updateTitle("Billing"),e.$shared=r,e.triedSubmit=!1,e.startDate=moment().startOf("month").toDate(),e.endDate=moment().endOf("month").toDate(),e.cards=[],e.creditAmounts=[{name:"$10",value:10},{name:"$25",value:25},{name:"$50",value:50},{name:"$100",value:100},{name:"$250",value:250}],e.settings={newCard:!1,type:"CARD"},e.data={selectedCard:null,creditAmount:null},e.card={name:"",address:"",city:"",postal_code:"",number:"",expires:"",cvv:""},e.createLabel=function(e){return"**** **** **** "+e.last_4},e.addCard=function(t){l.show({controller:p,templateUrl:"/views/dialogs/add-card.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!0,locals:{onSuccess:function(e){g(e).then(function(){f(!0)})},onError:function(){}}}).then(function(t){e.status='You said the information was "'+t+'".'},function(){e.status="You cancelled the dialog."})},e.addCredit=function(){var t={};if(console.log("card is ",e.data.selectedCard),console.log("amount is ",e.data.creditAmount),e.data.selectedCard){if("new"===e.data.selectedCard){(t={}).number=e.card.number,t.cvc=e.card.cvv;var n=e.card.expires.split("/");return t.exp_month=n[0],t.exp_year=n[1],t.address_zip=e.card.postal_code,void Stripe.card.createToken(t,function(t,n){n.error?e.errorMsg=n.error.message:(l.hide(),g(n).then(function(t){var n=t.headers("X-Card-ID");o(function(){e.$apply(),c(n,e.data.creditAmount.value)},0)})),o(function(){e.$apply(),c(cardId,e.data.creditAmount.value)},0)})}o(function(){e.$apply(),c(e.data.selectedCard,e.data.creditAmount.value)},0)}},e.addCreditPayPal=function(){var t={};console.log("card is ",e.data.selectedCard),console.log("amount is ",e.data.creditAmount),t.amount=e.data.creditAmount.value,r.isCreateLoading=!0,a.post("/credit/checkoutWithPayPal",t).then(function(e){var t=e.data;u.location.href=t.url,r.endIsCreateLoading()})},e.getCardOptions=function(){angular.copy(e.cards)},e.changeCard=function(t){console.log("changeCard ",t),e.data.selectedCard=t,e.settings.newCard="new"===t},e.changeBillingPackage=function(t){console.log("changeBillingPackage ",t),e.settings.billing_package=t},e.changeAmount=function(t){console.log("changeAmount ",t),e.data.creditAmount=t},e.changeAutoRechargeAmount=function(t){console.log("changeAutoRechargeAmount ",t),e.settings.db.auto_recharge_top_up=t},e.changeType=function(t){e.settings.type=t},e.saveSettings=function(){var t={};t.auto_recharge=e.settings.db.auto_recharge,t.invoices_by_email=e.settings.db.invoices_by_email,t.billing_package=e.settings.db.billing_package;var o=e.settings.db.auto_recharge_top_up.value;t.auto_recharge_top_up=100*o,console.log("recharge in cents is ",t.auto_recharge_top_up),r.isCreateLoading=!0,a.post("/changeBillingSettings",t).then(function(e){s.show(s.simple().textContent("Saved billing settings").position("top right").hideDelay(3e3)),r.endIsCreateLoading()})},e.filterBilling=function(){r.isCreateLoading=!0,m().then(function(t){e.history=t.data,r.endIsCreateLoading()})},e.downloadBilling=function(){var t=getJWTTokenObj();u.location.replace(createUrl("/downloadBillingHistory?startDate="+formatDate(e.startDate,!0)+"&endDate="+formatDate(e.endDate,!0)+"&auth="+t.token))},e.makeNicePackageName=function(e){return{gold:"Gold Route",silver:"Silver Route",bronze:"Bronze Route"}[e]},e.createTrigger=function(t){l.show({controller:d,templateUrl:"views/dialogs/create-trigger.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!0,fullscreen:e.customFullscreen,locals:{onCreate:function(){f(!1).then(function(){s.show(s.simple().textContent("Usage trigger create..").position("top right").hideDelay(3e3))})}}}).then(function(){},function(){})},e.deleteUsageTrigger=function(e,t){console.log("deleteUsageTrigger ",t);var o=l.confirm().title("Are you sure you want to delete this usage trigger?").textContent("you will no longer be reminded when this usage trigger's conditions are met").ariaLabel("Delete usage trigger").targetEvent(e).ok("Yes").cancel("No");l.show(o).then(function(){r.isLoading=!0,a.delete("/delUsageTrigger/"+t.id).then(function(){f(!1).then(function(){s.show(s.simple().textContent("Usage trigger deleted..").position("top right").hideDelay(3e3))})})},function(){})},f(!1)}),angular.module("MaterialApp").controller("BlockedNumbersCtrl",function(e,t,o,n,a,r,i,s,l){function u(e,t,o,n,a){e.$shared=n,e.error=!1,e.errorText="",e.data={number:""},e.submit=function(){var t=angular.copy(e.data);o.post("/settings/blockedNumbers",t).then(function(t){r.show(r.simple().textContent("Number verified").position("top right").hideDelay(3e3)),e.close(),a()})},e.close=function(){t.hide()}}s.updateTitle("Blocked Numbers"),e.numbers=[],e.load=function(){return s.isLoading=!0,l(function(o,n){t.get("/settings/blockedNumbers").then(function(t){e.numbers=t.data,s.endIsLoading(),o()},function(){n()})})},e.createNumber=function(t){a.show({controller:u,templateUrl:"views/dialogs/add-blocked-number.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!0,fullscreen:e.customFullscreen,locals:{onCreated:function(){e.load()}}}).then(function(){},function(){})},e.deleteNumber=function(o,n){var i=a.confirm().title("Are you sure you want to delete this number?").textContent("This will permantely remove the number from your blocked list").ariaLabel("Delete extension").targetEvent(o).ok("Yes").cancel("No");a.show(i).then(function(){s.isLoading=!0,t.delete("/settings/blockedNumbers/"+n.public_id).then(function(){e.load().then(function(){r.show(r.simple().textContent("Number deleted..").position("top right").hideDelay(3e3))})})},function(){})},e.load()}),angular.module("MaterialApp").controller("BodyCtrl",function(e,t){e.$shared=t}),angular.module("MaterialApp").controller("BuyNumbersCtrl",function(e,t,o,n,a,r){function i(e,t,o){e.number=o,e.cancel=function(){t.cancel()},e.gotoSettings=function(){t.hide(""),n.go("my-numbers-edit",{numberId:o.id})}}r.updateTitle("Buy Numbers"),e.countries=[{iso:"CA",name:"Canada"},{iso:"US",name:"United States"}],e.settings={country:"",region:"",pattern:"",rate_center:""},e.numbers=[],e.didFetch=!1,e.load=function(){r.endIsLoading()},e.fetch=function(o,n){if(e.triedSubmit=!0,n.$valid){var a={};a.region=e.settings.region,a.rate_center=e.settings.rate_center,a.prefix="",a.country_iso=e.settings.country.iso,r.isCreateLoading=!0,t.get("/did/available",{params:a}).then(function(t){e.numbers=t.data,e.didFetch=!0,r.endIsCreateLoading()})}},e.buyNumber=function(o,n){r.scrollTop();var s=a.confirm().title('Are you sure you want to purchase number "'+n.number+'"?').textContent("this number will cost you "+n.monthly_cost+" monthly. you may unrent this number at any time ").ariaLabel("Buy number").targetEvent(o).ok("Yes").cancel("No");a.show(s).then(function(){var s={};s.api_number=n.api_number,s.number=n.number,s.region=n.region,s.monthly_cost=n.monthly_cost,s.provider=n.provider,s.country=n.country,s.features=n.features.join(","),r.isCreateLoading=!0,r.scrollTop(),t.post("/did/saveNumber",s).then(function(n){t.get("/did/numberData/"+n.headers("X-Number-ID")).then(function(t){var n=t.data;r.endIsCreateLoading(),function(t,o){a.show({controller:i,templateUrl:"views/dialogs/purchase-did-confirm.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!0,fullscreen:e.customFullscreen,locals:{number:o}}).then(function(){},function(){})}(o,n)})},function(e){if(console.log("res is: ",e),400===e.status){var t=e.data;r.showError("Error",t.message)}})},function(){})},e.changeCountry=function(t){console.log("changeCountry ",t),e.settings.country=t},e.load()}),angular.module("MaterialApp").controller("CallsCtrl",function(e,t,o,n,a,r,i){i.updateTitle("Calls"),e.pagination=o,e.settings={page:0},e.calls=[],e.load=function(){i.isLoading=!0,o.resetSearch(),o.changeUrl("/call/listCalls"),o.changePage(1),o.changeScope(e,"calls"),o.loadData().then(function(t){e.calls=t.data.data,i.endIsLoading()})},e.viewCall=function(e){a.go("call-view",{callId:e.api_id})},e.load()}),angular.module("MaterialApp").controller("CallViewCtrl",function(e,t,o,n,a,r,i,s){s.updateTitle("Call View"),e.call=[],e.load=function(){s.isLoading=!0,t.get("/call/callData/"+r.callId).then(function(t){console.log("call is ",t.data),s.isLoading=!1;var o=t.data;o.recordings=o.recordings.map(function(e){return e.uri=i.trustAsResourceUrl(e.uri),e}),e.call=o})},e.load()}),angular.module("MaterialApp").controller("cardCtrl",["$scope","$timeout",function(e,t){e.options1={lineWidth:12,scaleColor:!1,size:120,lineCap:"square",barColor:"#fb8c00",trackColor:"#f9dcb8"}}]),angular.module("MaterialApp").controller("ChartCtrl",["$scope","$timeout",function(e,t){e.line={labels:["January","February","March","April","May","June","July"],data:[[65,59,80,81,56,55,40],[28,48,40,19,86,27,90]],colours:["#2979FF","#00D554","#7AB67B","#D9534F","#3faae3"],onClick:function(e,t){console.log(e,t)}},e.bar={labels:["2006","2007","2008","2009","2010","2011","2012"],data:[[65,59,80,81,56,55,40],[28,48,40,19,86,27,90]],colours:["#FFA726","#FF4081","#7AB67B","#D9534F","#3faae3"]},e.donut={labels:["Download Sales","In-Store Sales","Mail-Order Sales"],data:[300,500,100],colours:["#FF4081","#F0AD4E","#00D554","#D9534F","#3faae3"]},e.pie={labels:["Download Sales","In-Store Sales","Mail-Order Sales"],data:[300,500,100],colours:["#FF4081","#F0AD4E","#00D554","#D9534F","#3faae3"]},e.datapoints=[{x:10,"top-1":10,"top-2":15},{x:20,"top-1":100,"top-2":35},{x:30,"top-1":15,"top-2":75},{x:40,"top-1":50,"top-2":45}],e.datacolumns=[{id:"top-1",type:"spline"},{id:"top-2",type:"spline"}],e.datax={id:"x"}}]),angular.module("MaterialApp").controller("calendarCtrl",function(e){}),angular.module("MaterialApp").controller("componentCtrl",function(e,t,o,n){e.rating1=3,e.rating2=2,e.rating3=4;var a=this,r=0,i=0;a.modes=[],a.activated=!0,a.determinateValue=30,a.toggleActivation=function(){a.activated||(a.modes=[]),a.activated&&(r=i=0)},t(function(){a.determinateValue+=1,a.determinateValue>100&&(a.determinateValue=30),r<5&&!a.modes[r]&&a.activated&&(a.modes[r]="indeterminate"),i++%4==0&&r++},100,0,!0);var s={bottom:!1,top:!0,left:!1,right:!0};e.demo={},e.toastPosition=angular.extend({},s),e.getToastPosition=function(){return function(){var t=e.toastPosition;t.bottom&&s.top&&(t.top=!1);t.top&&s.bottom&&(t.bottom=!1);t.right&&s.left&&(t.left=!1);t.left&&s.right&&(t.right=!1);s=angular.extend({},t)}(),Object.keys(e.toastPosition).filter(function(t){return e.toastPosition[t]}).join(" ")},e.showCustomToast=function(){o.show(o.simple().content("Simple Toast!").position(e.getToastPosition()).hideDelay(3e4))},e.showSimpleToast=function(){o.show(o.simple().content("Simple Toast!").position(e.getToastPosition()).hideDelay(3e4))},e.showActionToast=function(){var t=o.simple().content("Action Toast!").action("OK").highlightAction(!1).position(e.getToastPosition());o.show(t).then(function(e){"ok"==e&&alert("You clicked 'OK'.")})}}).controller("ToastCtrl",function(e,t){e.closeToast=function(){t.hide()}}),angular.module("MaterialApp").controller("CreatePortCtrl",function(e,t,o,n,a,r,i,s,l){function u(t,o){return 0===angular.element(t).prop("files").length?(e.files[o]=!0,!1):(e.files[o]=!1,!0)}l.updateTitle("Create Number"),e.flows=[],e.number={first_name:"",last_name:"",city:"",state:"",zip:"",country:"",provider:"",number:"",address_line_1:"",address_line_2:""},e.files={noLOA:!1,noCSR:!1,noInvoice:!1},e.saveNumber=function(o){if(console.log("saveNumber"),e.triedSubmit=!0,u("#loa","noLOA")&&u("#csr","noCSR")&&u("#invoice","noInvoice")&&o.$valid){var a=new FormData;a.append("first_name",e.number.first_name),a.append("last_name",e.number.last_name),a.append("city",e.number.city),a.append("state",e.number.state),a.append("zip",e.number.zip),a.append("country",e.number.country.iso),a.append("provider",e.number.provider),a.append("number",e.number.number),a.append("address_line_1",e.number.address_line_1),a.append("address_line_2",e.number.address_line_2),a.append("loa",angular.element("#loa").prop("files")[0]),a.append("csr",angular.element("#csr").prop("files")[0]),a.append("invoice",angular.element("#invoice").prop("files")[0]),l.isLoading=!0;t.postFiles("/port/saveNumber",a,!0).then(function(){console.log("updated number.."),s.show(s.simple().textContent("Number port created..").position("top right").hideDelay(3e3)),n.go("ports",{})},function(){l.endIsLoading()})}},e.changeCountry=function(t){console.log("changeCountry ",t),e.number.country=t},l.endIsLoading()}),angular.module("MaterialApp").controller("DashboardCtrl",function(e,t,o,n,a,r,i){e.$shared=i,$(window).width()<1450&&($(".c-hamburger").removeClass("is-active"),$("body").removeClass("extended")),e.$state=t,o.$on("$stateChangeSuccess",function(){a(function(){$("body").scrollTop(0)},200)}),$("body").hasClass("extended")&&a(function(){},200),e.rtl=function(){$("body").toggleClass("rtl")},e.subnav=function(t){return t==e.showingSubNav?e.showingSubNav=0:e.showingSubNav=t,!1},e.extend=function(){$(".c-hamburger").toggleClass("is-active"),$("body").toggleClass("extended"),$(".sidebar").toggleClass("ps-container"),o.$broadcast("resize"),a(function(){console.log("pfscroll")},200)},e.changeTheme=function(e){$("<link>").appendTo("head").attr({type:"text/css",rel:"stylesheet"}).attr("href","styles/app-"+e+".css")},angular.element(r).bind("resize",function(){}),$(window).width()<1200&&o.$on("$stateChangeSuccess",function(){$(".c-hamburger").removeClass("is-active"),$("body").removeClass("extended")}),$(window).width()<600&&o.$on("$stateChangeSuccess",function(){$(".mdl-grid").removeAttr("dragula")}),e.changeLanguage=function(e){n.use(e)}}),angular.module("MaterialApp").controller("DashboardWelcomeCtrl",["$scope","$timeout","Backend","$shared","$q",function(e,t,o,n,a){n.updateTitle("Dashboard"),e.options1={lineWidth:8,scaleColor:!1,size:85,lineCap:"square",barColor:"#fb8c00",trackColor:"#f9dcb8"},e.options2={lineWidth:8,scaleColor:!1,size:85,lineCap:"square",barColor:"#00D554",trackColor:"#c7f9db"},e.options3={lineWidth:8,scaleColor:!1,size:85,lineCap:"square",barColor:"#F800FC",trackColor:"#F5E5F5"},e.labels=["January","February","March","April","May","June","July"],e.series=["Series A","Series B"],e.data=[[65,59,80,81,56,55,40],[28,48,40,19,86,27,90]],e.onClick=function(e,t){console.log(e,t)},$(window).width()<600&&$(".mdl-grid").removeAttr("dragula"),e.line2={labels:["JAN","FEB","MAR","APR","MAY","JUN"],data:[[99,180,80,140,120,220,100],[50,145,200,75,50,100,50]],colours:[{fillColor:"#2b36ff",strokeColor:"#C172FF",pointColor:"#fff",pointStrokeColor:"#8F00FF",pointHighlightFill:"#fff",pointHighlightStroke:"#8F00FF"},{fillColor:"#ffa01c",strokeColor:"#FFB53A",pointColor:"#fff",pointStrokeColor:"#FF8300",pointHighlightFill:"#fff",pointHighlightStroke:"#FF8300"}],options:{responsive:!0,bezierCurve:!1,datasetStroke:!1,legendTemplate:!1,pointDotRadius:9,pointDotStrokeWidth:3,datasetStrokeWidth:3},onClick:function(e,t){console.log(e,t)}},e.load=function(){t(function(){Chart.helpers.color;n.isLoading=!0,o.get("/dashboard").then(function(o){var a=o.data[0];n.billInfo=o.data[1],n.userInfo=o.data[2],e.checklist=o.data[3],console.log("graph data is ",a),n.isLoading=!1,t(function(){e.line={legend:!0,labels:a.labels,data:[a.data.inbound,a.data.outbound],series:["Inbound","Outbound"],colours:[{fillColor:"#3f51b5",strokeColor:"#3f51b5",pointColor:"#3f51b5",pointStrokeColor:"#3f51b5",pointHighlightFill:"#3f51b5",pointHighlightStroke:"#3f51b5"},{fillColor:"#3D3D3D",strokeColor:"#3D3D3D",pointColor:"#3D3D3D",pointStrokeColor:"#3D3D3D",pointHighlightFill:"#3D3D3D",pointHighlightStroke:"#3D3D3D"}],options:{legend:{display:!0,position:"right"},responsive:!0,bezierCurve:!1,datasetStroke:!1,pointDotRadius:6,showTooltips:!1},onClick:function(e,t){console.log(e,t)}}},0)})},0)},e.reloadGraph=function(){console.log("reloadGraph called.."),e.load()},e.userAccountNotCompleted=function(){return!e.checklist||!(e.checklist.created_account&&e.checklist.filled_personal_info&&e.checklist.registered_did&&e.checklist.added_billing_info)},e.load()}]),angular.module("MaterialApp").controller("DebuggerLogsCtrl",function(e,t,o,n,a,r,i,s){i.updateTitle("Debugger Logs"),e.pagination=o,e.settings={page:0},e.logs=[],e.load=function(){i.isLoading=!0,o.resetSearch(),o.changeUrl("/log/listLogs"),o.changePage(1),o.changeScope(e,"logs"),s.all([t.get("/flow/listFlows?all=1"),o.loadData()]).then(function(t){e.flows=t[0].data.data,e.logs=t[1].data.data,console.log("logs are ",e.logs),i.endIsLoading()})},e.viewLog=function(e){a.go("debugger-log-view",{logId:e.api_id})},e.load()}),angular.module("MaterialApp").controller("EditPortCtrl",function(e,t,o,n,a,r,i,s,l){function u(e,t){return 0!==angular.element(e).prop("files").length}l.updateTitle("Edit Port Number"),e.flows=[],e.number=null,e.number={first_name:"",last_name:"",city:"",state:"",zip:"",country:"",provider:"",number:"",address_line_1:"",address_line_2:""},e.files={noLOA:!1,noCSR:!1,noInvoice:!1},e.saveNumber=function(o){if(console.log("saveNumber"),e.triedSubmit=!0,o.$valid){var r=new FormData;if(r.append("first_name",e.number.first_name),r.append("last_name",e.number.last_name),r.append("city",e.number.city),r.append("state",e.number.state),r.append("zip",e.number.zip),r.append("country",e.number.country.iso),r.append("provider",e.number.provider),r.append("number",e.number.number),r.append("address_line_1",e.number.address_line_1),r.append("address_line_2",e.number.address_line_2),u("#loa")&&r.append("loa",angular.element("#loa").prop("files")[0]),u("#csr"))r.append("csr",angular.element("#csr").prop("files")[0]);else if(u("#invoice"))r.append("invoice",angular.element("#invoice").prop("files")[0]);else{l.isLoading=!0;t.postFiles("/port/updateNumber/"+a.numberId,r,!0).then(function(){console.log("updated number.."),s.show(s.simple().textContent("Number port created..").position("top right").hideDelay(3e3)),n.go("ports",{})},function(){l.endIsLoading()})}}},e.changeCountry=function(t){console.log("changeCountry ",t),e.number.country=t},e.documentURL=function(t){var o;return angular.forEach(e.number.documents,function(e){e.type===t&&(o=e.url)}),o},l.isLoading=!0,t.get("/port/numberData/"+a.numberId).then(function(t){e.number=t.data,angular.forEach(l.billingCountries,function(t){t.iso===e.number.country&&(e.number.country=t)}),e.loa=l.endIsLoading()})}),angular.module("MaterialApp").controller("ExtensionCodesCtrl",function(e,t,o,n,a,r,i,s,l){s.updateTitle("Extension Codes"),e.users=[],e.load=function(){return s.isLoading=!0,l(function(o,n){l.all([t.get("/flow/listFlows?all=1"),t.get("/settings/extensionCodes")]).then(function(t){e.flows=t[0].data.data;var n=t[1].data;angular.forEach(n,function(t){angular.forEach(e.flows,function(e){e.id===t.flow_id&&(t.flow=e)})}),e.codes=n,s.endIsLoading(),o()},function(){n()})})},e.saveCodes=function(){var o={codes:angular.copy(e.codes).map(function(e){return delete e.flow,e})};s.isCreateLoading=!0,t.post("/settings/extensionCodes",o).then(function(e){r.show(r.simple().textContent("Extension codes updated..").position("top right").hideDelay(3e3)),s.endIsCreateLoading()})},e.addCode=function(){e.codes.push({name:"",flow_id:null})},e.changeFlow=function(t){console.log("changeFlow called ",arguments),console.log("codes are ",e.codes),e.codes[t].flow_id=e.codes[t].flow.id},e.removeCode=function(t,o){e.codes.splice(t,1)},e.load()}),angular.module("MaterialApp").controller("ExtensionCreateCtrl",function(e,t,o,n,a,r,i,s){s.updateTitle("Create Extension"),e.values={username:"",secret:""},e.ui={showSecret:!1,secretStrength:0},e.triedSubmit=!1,e.generateSecret=function(){e.values.secret=generatePassword()},e.showSecret=function(){e.ui.showSecret=!0},e.hideSecret=function(){e.ui.showSecret=!1},e.submit=function(o){if(console.log("submitting extension form ",arguments),e.triedSubmit=!0,o.$valid){var a={};a.username=e.values.username,a.caller_id=e.values.caller_id,a.secret=e.values.secret,a.flow_id=e.values.flow_id;var i={bottom:!1,top:!0,left:!1,right:!0},l=Object.keys(i).filter(function(e){return i[e]}).join(" ");console.log("toastPosStr",l),s.isCreateLoading=!0,t.post("/extension/saveExtension",a).then(function(){console.log("updated extension.."),r.show(r.simple().textContent("Created extension").position("top right").hideDelay(3e3)),n.go("extensions",{}),s.endIsCreateLoading()})}},e.keyupSecret=function(){var t=zxcvbn(e.values.secret);e.ui.secretStrength=(25*t.score).toString()+"%"},e.changeFlow=function(t){e.values.flow_id=t,console.log("changeFlow",t)},e.editFlow=function(e){n.go("flow-editor",{flowId:e})},i(function(){t.get("/flow/listFlows").then(function(t){e.flows=t.data.data,s.endIsLoading()})},0)}),angular.module("MaterialApp").controller("ExtensionEditCtrl",function(e,t,o,n,a,r,i,s,l){s.updateTitle("Edit Extension"),e.values={username:"",secret:"",flow_id:""},e.ui={showSecret:!1,secretStrength:0},e.triedSubmit=!1,e.load=function(){s.isLoading=!0,l.all([t.get("/flow/listFlows"),t.get("/extension/extensionData/"+i.extensionId)]).then(function(t){e.flows=t[0].data.data,e.extension=t[1].data,e.values=angular.copy(e.extension),s.endIsLoading()})},e.generateSecret=function(){e.values.secret=generatePassword()},e.showSecret=function(){e.ui.showSecret=!0},e.hideSecret=function(){e.ui.showSecret=!1},e.submit=function(o){if(console.log("submitting extension form ",arguments),e.triedSubmit=!0,o.$valid){var a={};a.username=e.values.username,a.secret=e.values.secret,a.caller_id=e.values.caller_id,a.flow_id=e.values.flow_id;var l={bottom:!1,top:!0,left:!1,right:!0},u=Object.keys(l).filter(function(e){return l[e]}).join(" ");console.log("toastPosStr",u),s.isCreateLoading=!0,t.post("/extension/updateExtension/"+i.extensionId,a).then(function(){console.log("updated extension.."),r.show(r.simple().textContent("Updated extension").position("top right").hideDelay(3e3)),n.go("extensions",{}),s.endIsCreateLoading()})}},e.keyupSecret=function(){var t=zxcvbn(e.values.secret);e.ui.secretStrength=(25*t.score).toString()+"%"},e.changeFlow=function(t){e.values.flow_id=t,console.log("changeFlow",t)},e.editFlow=function(e){n.go("flow-editor",{flowId:e})},e.load()}),angular.module("MaterialApp").controller("ExtensionsCtrl",function(e,t,o,n,a,r,i,s,l){function u(e,t,o,n){e.$shared=n,e.extension=o,e.close=function(){t.hide()}}s.updateTitle("Extensions"),e.pagination=o,e.settings={page:0},e.extensions=[],e.load=function(){return s.isLoading=!0,o.resetSearch(),o.changeUrl("/extension/listExtensions"),o.changePage(1),o.changeScope(e,"extensions"),l(function(t,n){o.loadData().then(function(o){e.extensions=o.data.data,s.endIsLoading(),t()},n)})},e.editExtension=function(e){a.go("extension-edit",{extensionId:e.public_id})},e.createExtension=function(e){a.go("extension-create",{})},e.connectInfo=function(t,o){r.show({controller:u,templateUrl:"views/dialogs/extension-connect-info.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!0,fullscreen:e.customFullscreen,locals:{extension:o}}).then(function(){},function(){})},e.deleteExtension=function(o,n){var a=r.confirm().title("Are you sure you want to delete this extension?").textContent("This will permantely remove the extension and you will no longer be able to use it").ariaLabel("Delete extension").targetEvent(o).ok("Yes").cancel("No");r.show(a).then(function(){s.isLoading=!0,t.delete("/extension/deleteExtension/"+n.public_id).then(function(){e.load().then(function(){i.show(i.simple().textContent("Extension deleted..").position("top right").hideDelay(3e3))})})},function(){})},e.load()}),angular.module("MaterialApp").controller("FaxesCtrl",function(e,t,o,n,a,r,i,s,l,u){s.updateTitle("Faxes"),e.settings={page:0},e.pagination=o,e.faxes=[],e.load=function(){return l(function(t,n){s.isLoading=!0,o.resetSearch(),o.changeUrl("/fax/listFaxes"),o.changePage(1),o.changeScope(e,"faxes"),o.loadData().then(function(o){var n=o.data.data;e.faxes=n.map(function(e){return e.uri=i.trustAsResourceUrl(e.uri),e}),s.endIsLoading(),t()},n)})},e.deleteFax=function(o,n){var a=r.confirm().title("Are you sure you want to delete this fax?").textContent("This will permantely remove the fax from your storage").ariaLabel("Delete fax").targetEvent(o).ok("Yes").cancel("No");r.show(a).then(function(){s.isLoading=!0,t.delete("/fax/deleteFax/"+n.id).then(function(){console.log("deleted fax.."),e.load().then(function(){u.show(u.simple().textContent("fax deleted..").position("top right").hideDelay(3e3))})})},function(){})},e.load()}),angular.module("MaterialApp").controller("FilesCtrl",function(e,t,o,n,a,r,i,s,l){function u(e,t,o,n,a){e.$shared=n,e.error=!1,e.errorText="",e.data={file:null},e.submit=function(r){var i=angular.element("#uploadFile").prop("files");if(0!==i.length){var s=new FormData;angular.forEach(i,function(e){s.append("file[]",e)}),n.isCreateLoading=!0,o.postFiles("/file/upload",s,!0).then(function(e){var o=e.data;n.endIsCreateLoading(),o.amountFailed>0&&angular.forEach(o.results,function(e){if(!e.success){var t=e.name+" failed to upload please check the file type and size";n.showToast(t)}}),t.hide(),a()})}else e.errorText="Please select atleast 1 file.."},e.close=function(){t.hide()}}function d(e,t,o,n,a){e.$shared=n,e.error=!1,e.errorText="",e.data={number:""},e.clickUpload=function(o){t.show({controller:u,templateUrl:"views/dialogs/upload-addfile.html",parent:angular.element(document.body),targetEvent:o,clickOutsideToClose:!0,fullscreen:e.customFullscreen,locals:{onFinished:function(){a()}}}).then(function(){},function(){})},e.clickGoogle=function(e){gapi.load("auth",{callback:m}),gapi.load("picker",{callback:f})},e.close=function(){t.hide()}}s.updateTitle("Extension Codes"),e.files=[],e.load=function(){return s.isLoading=!0,l(function(o,n){t.get("/file/listFiles").then(function(t){e.files=t.data.data,s.endIsLoading(),o()},function(){n()})})},e.addFile=function(t){a.show({controller:d,templateUrl:"views/dialogs/select-addfile.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!0,fullscreen:e.customFullscreen,locals:{onFinished:function(){e.load()}}}).then(function(){},function(){})},e.deleteFile=function(o,n){var i=a.confirm().title("Are you sure you want to delete this media file?").textContent("please note that any call flows using this media file may be effected.").ariaLabel("Delete file").targetEvent(o).ok("Yes").cancel("No");a.show(i).then(function(){s.isLoading=!0,t.delete("/file/deleteFile/"+n.id).then(function(){e.load().then(function(){r.show(r.simple().textContent("File deleted..").position("top right").hideDelay(3e3))})})},function(){})};var c,g=["https://www.googleapis.com/auth/drive.file"],p=!1;function m(){window.gapi.auth.authorize({client_id:google.clientId,scope:g,immediate:!1},h)}function f(){p=!0,b()}function h(e){e&&!e.error&&(c=e.access_token,b())}function b(){if(p&&c){var e=new google.picker.View(google.picker.ViewId.DOCS);e.setMimeTypes("audio/vnd.wave,audio/wav,audio/wave,audio/x-wav,audio/wav,audio/mpeg,audio/mp3"),(new google.picker.PickerBuilder).enableFeature(google.picker.Feature.NAV_HIDDEN).enableFeature(google.picker.Feature.MULTISELECT_ENABLED).setAppId(google.appId).setOAuthToken(c).addView(e).setDeveloperKey(google.developerKey).setCallback(v).build().setVisible(!0)}}function v(o){if(o.action==google.picker.Action.PICKED){var n=[],r=o.docs[0].id;n.push(r);o={files:n,accessToken:c};s.isCreateLoading=!0,t.post("/file/uploadByGoogleDrive",o).then(function(t){var o=t.data;s.endIsCreateLoading(),o.amountFailed>0&&angular.forEach(o.results,function(e){if(!e.success){var t=e.name+" failed to upload please check the file type and size";s.showToast(t)}}),i(function(){e.$apply(),a.hide(),e.load()},0)})}}e.promptCopied=function(){r.show(r.simple().textContent("Copied to clipboard!").position("top right").hideDelay(3e3))},e.load()}),angular.module("MaterialApp").controller("FlowEditorCtrl",function(e,t,o,n,a,r,i,s){function l(){var e=angular.element(".flow-editor-iframe"),t=$(window).outerHeight();e.attr("height",t)}var u;r.updateTitle("Flow Editor"),e.settings={page:0},e.numbers=[];var d=r.getAuthToken(),c=r.getWorkspace();u="new"===i.flowId?r.FLOW_EDITOR_URL+"/create?auth="+d.token.auth+"&workspaceId="+c.id:r.FLOW_EDITOR_URL+"/edit?flowId="+i.flowId+"&auth="+d.token.auth+"&workspaceId="+c.id,e.flowUrl=s.trustAsResourceUrl(u),console.log("flow url is ",e.flowUrl),r.collapseNavbar();angular.element(".flow-editor-iframe");l(),angular.element("window").on("resize.editor",function(){l()})}),angular.module("MaterialApp").controller("FlowsCtrl",function(e,t,o,n,a,r,i,s,l){s.updateTitle("Flows"),e.pagination=o,e.settings={page:0},e.flows=[],e.load=function(){return l(function(t,n){s.isLoading=!0,o.resetSearch(),o.changeUrl("/flow/listFlows"),o.changePage(1),o.changeScope(e,"flows"),o.loadData().then(function(o){e.flows=o.data.data,s.endIsLoading(),t()},n)})},e.editFlow=function(e){s.changeRoute("flow-editor",{flowId:e.public_id})},e.createFlow=function(){s.changeRoute("flow-editor",{flowId:"new"})},e.deleteFlow=function(o,n){var a=r.confirm().title("Are you sure you want to delete this flow?").textContent("This will permantely remove the flow and also unset the flow on numbers that have this flow attached to it").ariaLabel("Delete flow").targetEvent(o).ok("Yes").cancel("No");r.show(a).then(function(){s.isLoading=!0,t.delete("/flow/deleteFlow/"+n.id).then(function(){i.show(i.simple().textContent("Flow deleted..").position("top right").hideDelay(3e3)),e.load().then(function(){i.show(i.simple().textContent("Flow deleted..").position("top right").hideDelay(3e3))})})},function(){})},e.load()}),angular.module("MaterialApp").controller("ForgotCtrl",function(e,t,o,n,a,r,i,s,l){r.updateTitle("Forgot Password"),e.triedSubmit=!1,e.isLoading=!1,e.user={email:""},e.submit=function(t,o){if(e.triedSubmit=!0,o.$valid){var n=angular.copy(e.user);return e.isLoading=!0,void a.post("/forgot",n).then(function(t){t.data;e.isLoading=!1,s.show(s.simple().textContent("Reset instructions sent to email..").position("top right").hideDelay(3e3))}).catch(function(){e.isLoading=!1})}},e.gotoLogin=function(){r.changingPage=!0,r.scrollToTop(),i.go("login")},r.changingPage=!1}),angular.module("MaterialApp").controller("HeadCtrl",function(e,t){e.$shared=t}),angular.module("MaterialApp").controller("HomeCtrl",["$scope","$timeout","Backend","$shared","$q",function(e,t,o,n,a){n.updateTitle("Dashboard"),e.options1={lineWidth:8,scaleColor:!1,size:85,lineCap:"square",barColor:"#fb8c00",trackColor:"#f9dcb8"},e.options2={lineWidth:8,scaleColor:!1,size:85,lineCap:"square",barColor:"#00D554",trackColor:"#c7f9db"},e.options3={lineWidth:8,scaleColor:!1,size:85,lineCap:"square",barColor:"#F800FC",trackColor:"#F5E5F5"},e.labels=["January","February","March","April","May","June","July"],e.series=["Series A","Series B"],e.data=[[65,59,80,81,56,55,40],[28,48,40,19,86,27,90]],e.onClick=function(e,t){console.log(e,t)},$(window).width()<600&&$(".mdl-grid").removeAttr("dragula"),e.line2={labels:["JAN","FEB","MAR","APR","MAY","JUN"],data:[[99,180,80,140,120,220,100],[50,145,200,75,50,100,50]],colours:[{fillColor:"#2b36ff",strokeColor:"#C172FF",pointColor:"#fff",pointStrokeColor:"#8F00FF",pointHighlightFill:"#fff",pointHighlightStroke:"#8F00FF"},{fillColor:"#ffa01c",strokeColor:"#FFB53A",pointColor:"#fff",pointStrokeColor:"#FF8300",pointHighlightFill:"#fff",pointHighlightStroke:"#FF8300"}],options:{responsive:!0,bezierCurve:!1,datasetStroke:!1,legendTemplate:!1,pointDotRadius:9,pointDotStrokeWidth:3,datasetStrokeWidth:3},onClick:function(e,t){console.log(e,t)}},e.load=function(){t(function(){Chart.helpers.color;n.isLoading=!0,o.get("/dashboard").then(function(o){var a=o.data[0];n.billInfo=o.data[1],n.userInfo=o.data[2],console.log("graph data is ",a),n.isLoading=!1,t(function(){e.line={legend:!0,labels:a.labels,data:[a.data.inbound,a.data.outbound],series:["Inbound","Outbound"],colours:[{fillColor:"#3f51b5",strokeColor:"#3f51b5",pointColor:"#3f51b5",pointStrokeColor:"#3f51b5",pointHighlightFill:"#3f51b5",pointHighlightStroke:"#3f51b5"},{fillColor:"#3D3D3D",strokeColor:"#3D3D3D",pointColor:"#3D3D3D",pointStrokeColor:"#3D3D3D",pointHighlightFill:"#3D3D3D",pointHighlightStroke:"#3D3D3D"}],options:{legend:{display:!0,position:"right"},responsive:!0,bezierCurve:!1,datasetStroke:!1,pointDotRadius:6,showTooltips:!1},onClick:function(e,t){console.log(e,t)}}},0)})},0)},e.reloadGraph=function(){console.log("reloadGraph called.."),e.load()},e.load()}]),angular.module("MaterialApp").controller("IpWhitelistCtrl",function(e,t,o,n,a,r,i,s,l){function u(e,t,o,n,a){e.$shared=n,e.error=!1,e.errorText="",e.ranges=["/8","/16","/24","/32"],e.data={ip:"",range:"/32"},e.submit=function(){var t=angular.copy(e.data);o.post("/settings/ipWhitelist",t).then(function(t){r.show(r.simple().textContent("IP added").position("top right").hideDelay(3e3)),e.close(),a()})},e.close=function(){t.hide()}}s.updateTitle("IP Whitelist"),e.settings={disabled:!1},e.ips=[],e.load=function(){return s.isLoading=!0,l(function(o,n){l.all([t.get("/self"),t.get("/settings/ipWhitelist")]).then(function(t){e.disabled=t[0].data.ip_whitelist_disabled,e.settings.disabled=e.disabled,e.ips=t[1].data,s.endIsLoading(),o()},function(){n()})})},e.createIp=function(t){a.show({controller:u,templateUrl:"views/dialogs/add-ip-whitelist.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!0,fullscreen:e.customFullscreen,locals:{onCreated:function(){e.load()}}}).then(function(){},function(){})},e.deleteIp=function(o,n){var i=a.confirm().title("Are you sure you want to delete this IP address?").textContent("This will permantely remove the IP from your whitelist").ariaLabel("Delete IP").targetEvent(o).ok("Yes").cancel("No");a.show(i).then(function(){s.isLoading=!0,t.delete("/settings/ipWhitelist/"+n.public_id).then(function(){e.load().then(function(){r.show(r.simple().textContent("IP deleted..").position("top right").hideDelay(3e3))})})},function(){})},e.enableWhitelist=function(o,n){return s.isLoading=!0,l(function(o,a){var r={ip_whitelist_disabled:n};t.post("/updateSelf",r).then(function(t){e.load(),o()},function(){a()})})},e.changeDisableState=function(t,o){console.log("changeDisableState ",o),e.enableWhitelist(t,!0)},e.load()}),angular.module("MaterialApp").controller("LoginCtrl",function(e,t,o,n,a,r,i,s){r.updateTitle("Login"),r.processResult(),e.triedSubmit=!1,e.couldNotLogin=!1,e.noUserFound=!1,e.shouldSplash=!1,e.isLoading=!1,e.challenge=null,e.user={email:"",password:""},e.step=1;var l=!1;function u(t,o){console.log("finishLogin ",arguments),e.isLoading=!1,e.couldNotLogin=!1,r.setAuthToken(t),r.setWorkspace(o),s.watch(),i.go("dashboard-user-welcome",{})}e.submit1=function(t,o){e.step=2},e.submit1=function(t,o){e.triedSubmit=!0,o.$valid&&(r.changingPage=!0,a.get("/getUserInfo?email="+e.user.email).then(function(t){if(r.changingPage=!1,t.data.found)return e.userInfo=t.data.info,void(e.step=2);e.noUserFound=!0}))},e.submit=function(t,o){if(e.triedSubmit=!0,o.$valid){var n=angular.copy(e.user);return n.challenge=e.challenge,e.isLoading=!0,void a.post("/jwt/authenticate",n).then(function(e){u(e.data,e.data.workspace)}).catch(function(){e.isLoading=!1,e.couldNotLogin=!0})}},e.gotoRegister=function(){r.changingPage=!0,r.scrollToTop(),i.go("register")},e.gotoForgot=function(){r.changingPage=!0,r.scrollToTop(),i.go("forgot")},e.startThirdPartyLogin=function(t,n,s,l){var d={};d.email=t,d.first_name=n,d.last_name=s,d.avatar=l,d.challenge=e.challenge,r.changingPage=!0,a.post("/thirdPartyLogin",d).then(function(t){o(function(){e.$apply(),r.scrollToTop(),t.data.confirmed?u(t.data.info,t.data.info.workspace):i.go("register",{hasData:!0,userId:t.data.userId,authData:{token:t.data.info.token}})},0)})},e.backStep1=function(){e.step=1},r.changingPage=!1,angular.element("#gSignIn").on("click",function(){l=!0});var d=window.location.host.split("."),c=d[0],g=c.split(":");"app"!==c&&"localhost"!==g[0]&&"ngrok"!==d[1]&&(e.challenge=c),gapi.signin2.render("gSignIn",{scope:"profile email",width:400,height:50,longtitle:!0,theme:"dark",onsuccess:function(t){if(l){var o=t.getBasicProfile();console.log("ID: "+o.getId()),console.log("Name: "+o.getName()),console.log("Image URL: "+o.getImageUrl()),console.log("Email: "+o.getEmail()),angular.element("body").scope();var n=o.getName().split(" "),a=n[0],r=n[n.length-1];e.startThirdPartyLogin(o.getEmail(),a,r,o.getImageUrl())}},onerror:function(e){console.log("Google signIn2.render button err: "+e)},onfailure:function(){console.error("failure ",arguments)}})}),angular.module("MaterialApp").controller("DebuggerLogViewCtrl",function(e,t,o,n,a,r,i,s){s.updateTitle("Log View"),e.log=null,e.load=function(){s.isLoading=!0,t.get("/log/logData/"+r.logId).then(function(t){console.log("log is ",t.data),s.isLoading=!1;var o=t.data;e.log=o})},e.load()}),angular.module("MaterialApp").controller("ModalDemoCtrl",function(e,t,o){e.items=["item1","item2","item3"],e.open=function(n){t.open({templateUrl:"myModalContent.html",controller:"ModalInstanceCtrl",size:n,resolve:{items:function(){return e.items}}}).result.then(function(t){e.selected=t},function(){o.info("Modal dismissed at: "+new Date)})}}),angular.module("MaterialApp").controller("ModalInstanceCtrl",function(e,t,o){e.items=o,e.selected={item:e.items[0]},e.ok=function(){t.close(e.selected.item)},e.cancel=function(){t.dismiss("cancel")}}),angular.module("MaterialApp").controller("MyNumbersCtrl",function(e,t,o,n,a,r,i,s,l){s.updateTitle("My Numbers"),e.pagination=o,e.numbers=[],e.load=function(){return l(function(t,n){s.isLoading=!0,o.resetSearch(),o.changeUrl("/did/listNumbers"),o.changePage(1),o.changeScope(e,"numbers"),o.loadData().then(function(o){e.numbers=o.data.data,s.endIsLoading(),t()},n)})},e.buyNumber=function(){a.go("buy-numbers",{})},e.editNumber=function(e){a.go("my-numbers-edit",{numberId:e.public_id})},e.deleteNumber=function(o,n){var a=r.confirm().title("Are you sure you want to delete this number?").textContent("If you delete this number you will not be able to call it anymore").ariaLabel("Delete number").targetEvent(o).ok("Yes").cancel("No");r.show(a).then(function(){s.isLoading=!0,t.delete("/did/deleteNumber/"+n.id).then(function(){e.load().then(function(){i.show(i.simple().textContent("Number deleted..").position("top right").hideDelay(3e3))})})},function(){})},e.load()}),angular.module("MaterialApp").controller("MyNumbersEditCtrl",function(e,t,o,n,a,r,i,s,l){l.updateTitle("Edit Number"),e.flows=[],e.didActions=[{name:"Accept Call",value:"accept-call"},{name:"Accept Fax",value:"accept-fax"}],e.number=null,e.saveNumber=function(o){var r={};r.name=e.number.name,r.flow_id=e.number.flow_id,r.did_action=e.number.did_action,r.tags=e.number.tags;var i={bottom:!1,top:!0,left:!1,right:!0},u=Object.keys(i).filter(function(e){return i[e]}).join(" ");console.log("toastPosStr",u),l.isCreateLoading=!0,t.post("/did/updateNumber/"+a.numberId,r).then(function(){console.log("updated number.."),s.show(s.simple().textContent("Number updated..").position(u).hideDelay(3e3)),n.go("my-numbers",{}),l.endIsCreateLoading()})},e.changeFlow=function(t){e.number.flow_id=t,console.log("changeFlow",t)},e.changeDIDAction=function(t){e.number.did_action=t,console.log("changeDIDAction",t)},e.editFlow=function(e){n.go("flow-editor",{flowId:e})},l.isLoading=!0,i.all([t.get("/flow/listFlows?all=1"),t.get("/did/numberData/"+a.numberId)]).then(function(t){e.flows=t[0].data.data,e.number=t[1].data,l.endIsLoading()})}),angular.module("MaterialApp").controller("PaginationDemoCtrl",function(e,t){e.totalItems=64,e.currentPage=4,e.setPage=function(t){e.currentPage=t},e.pageChanged=function(){t.log("Page changed to: "+e.currentPage)},e.maxSize=5,e.bigTotalItems=175,e.bigCurrentPage=1}),angular.module("MaterialApp").controller("paperCtrl",["$scope","$timeout","$mdDialog",function(e,t,o){function n(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()}}e.status="  ",e.showAdvanced=function(e){o.show({controller:n,templateUrl:"views/pages/dashboard/mail/compose.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0})},e.cards=[{name:"Gary Neville",subject:"Once a scouse, always a scouse.",body:"Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.",time:"30 minutes ago"},{name:"Antony Martial",subject:"Meet up in LA.",body:"Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.",time:"30 minutes ago"},{name:"Danny Ings",subject:"Request for loan.",body:"Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.",time:"30 minutes ago"},{name:"Roberto Firmoni",subject:"No match time!",body:"Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.",time:"30 minutes ago"},{name:"Lewandowski",subject:"Watch that?",body:"Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.",time:"30 minutes ago"},{name:"Pep Guardiola",subject:"When is BR Leaving?",body:"Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.",time:"30 minutes ago"}]}]),angular.module("MaterialApp").controller("piechartCtrl",["$scope",function(e){e.options1={animate:{duration:2e3,enabled:!0},barColor:"#F0AD4E",trackColor:"#ECF0F1",scaleColor:"#737373",lineWidth:5,size:115,lineCap:"circle"},e.options2={animate:{duration:2e3,enabled:!0},barColor:"#3CA2E0",trackColor:"#ECF0F1",scaleColor:"#737373",lineWidth:5,size:115,lineCap:"circle"},e.options3={animate:{duration:2e3,enabled:!0},barColor:"#D9534F",trackColor:"#ECF0F1",scaleColor:"#737373",lineWidth:5,size:115,lineCap:"circle"}}]),angular.module("MaterialApp").controller("PortNumbersCtrl",function(e,t,o,n,a,r,i,s,l){s.updateTitle("Ported Numbers"),e.pagination=o,e.numbers=[],e.load=function(){return l(function(t,n){s.isLoading=!0,o.resetSearch(),o.changeUrl("/port/listNumbers"),o.changePage(1),o.changeScope(e,"numbers"),o.loadData().then(function(o){e.numbers=o.data.data,s.endIsLoading(),t()},n)})},e.portNumber=function(){a.go("port-create",{})},e.editNumber=function(e){a.go("port-edit",{numberId:e.public_id})},e.deleteNumber=function(o,n){var a=r.confirm().title("Are you sure you want to delete this number?").textContent("If you delete this number you will not be able to call it anymore").ariaLabel("Delete number").targetEvent(o).ok("Yes").cancel("No");r.show(a).then(function(){s.isLoading=!0,t.delete("/port/deleteNumber/"+n.id).then(function(){e.load().then(function(){i.show(i.simple().textContent("Number deleted..").position("top right").hideDelay(3e3))})})},function(){})},e.load()}),angular.module("MaterialApp").controller("profileCtrl",function(e){e.products=[{url:"images/portrait1.jpg"},{url:"images/portrait2.jpg"},{url:"images/portrait3.jpg"},{url:"images/portrait4.jpg"},{url:"images/portrait5.jpg"},{url:"images/portrait7.jpg"},{url:"images/portrait8.jpg"},{url:"images/portrait9.jpg"}]}),angular.module("MaterialApp").controller("ProgressDemoCtrl",function(e){e.max=200,e.random=function(){var t,o=Math.floor(100*Math.random()+1);t=o<25?"success":o<50?"info":o<75?"warning":"danger",e.showWarning="danger"===t||"warning"===t,e.dynamic=o,e.type=t},e.random(),e.randomStacked=function(){e.stacked=[];for(var t=["success","info","warning","danger"],o=0,n=Math.floor(4*Math.random()+1);o<n;o++){var a=Math.floor(4*Math.random());e.stacked.push({value:Math.floor(30*Math.random()+1),type:t[a]})}},e.randomStacked()}),angular.module("MaterialApp").controller("RecordingsCtrl",function(e,t,o,n,a,r,i,s,l,u){s.updateTitle("Recordings"),e.settings={page:0},e.pagination=o,e.recordings=[],e.load=function(){return l(function(t,n){s.isLoading=!0,o.resetSearch(),o.changeUrl("/recording/listRecordings"),o.changePage(1),o.changeScope(e,"recordings"),o.loadData().then(function(o){var n=o.data.data;e.recordings=n.map(function(e){return e.uri=i.trustAsResourceUrl(e.uri),e}),s.endIsLoading(),t()},n)})},e.deleteRecording=function(o,n){var a=r.confirm().title("Are you sure you want to delete this recording?").textContent("This will permantely remove the recordings from your storage").ariaLabel("Delete recording").targetEvent(o).ok("Yes").cancel("No");r.show(a).then(function(){s.isLoading=!0,t.delete("/recording/deleteRecording/"+n.id).then(function(){console.log("deleted recording.."),e.load().then(function(){u.show(u.simple().textContent("recording deleted..").position("top right").hideDelay(3e3))})})},function(){})},e.load()}),angular.module("MaterialApp").controller("RegisterCtrl",function(e,t,o,n,a,r,i,s,l,u){r.updateTitle("Register");var d={US:"+1",CA:"+1"};e.triedSubmit=!1,e.passwordsDontMatch=!1,e.shouldSplash=!1,e.didVerifyCall=!1,e.step=1,e.userId=null,e.token=null,e.invalidCode=!1,e.invalidNumber=!1,e.user={first_name:"",last_name:"",email:"",password:"",password2:""},e.verify1={country:"US",mobile_number:""},e.verify2={confirmation_code:""},e.workspace="",e.selectedTemplate=null,e.submit=function(t,o){if(console.log("called submit"),e.triedSubmit=!0,console.log("data is ",e.user),console.log("form ",o),e.user.password===e.user.password2){if(e.passwordsDontMatch=!1,o.$valid){var n=angular.copy(e.user);return r.changingPage=!0,void a.post("/register",n).then(function(t){var o=t.data;o.success?(e.token=o,e.userId=o.userId,r.changingPage=!1,e.step=2):r.showError("Error",o.message)})}return!1}e.passwordsDontMatch=!0},e.submitVerify1Form=function(t,o){if(console.log("called submitVerify1Form"),e.triedSubmit=!0,o.$valid){var n={};return n.mobile_number=d[e.verify1.country]+e.verify1.mobile_number,n.userId=e.userId,r.changingPage=!0,void a.post("/registerSendVerify",n).then(function(t){t.data;if(r.changingPage=!1,t.data.valid)return e.didVerifyCall=!0,void(e.invalidNumber=!1);e.invalidNumber=!0})}return!1},e.submitVerify2Form=function(t,o){if(console.log("called submitVerify2Form"),e.triedSubmit=!0,o.$valid){var n=angular.copy(e.verify2);return n.userId=e.userId,r.changingPage=!0,void a.post("/registerVerify",n).then(function(t){var o=t.data.isValid;r.changingPage=!1,o?e.step=3:e.invalidCode=!0})}return!1},e.submitWorkspaceForm=function(t,o){if(console.log("called submitWorkspaceForm"),e.triedSubmit=!0,o.$valid){var n={};n.userId=e.userId,n.workspace=e.workspace,r.changingPage=!0,a.post("/updateWorkspace",n).then(function(t){if(r.changingPage=!1,t.data.success)return e.invalidWorkspaceTaken=!1,void(e.step=4);e.invalidWorkspaceTaken=!0})}return!1},e.finishSignup=function(){if(e.triedSubmit=!0,e.selectedTemplate){var t={};return t.userId=e.userId,t.templateId=e.selectedTemplate.id,r.changingPage=!0,a.post("/provisionCallSystem",t).then(function(t){r.changingPage=!1,function(){e.shouldSplash=!0,r.setAuthToken(e.token);var t={userId:e.userId};e.invalidCode=!1,r.changingPage=!0,a.post("/userSpinup",t).then(function(t){if(t.data.success)return l.watch(),r.setAuthToken(e.token),r.setWorkspace(t.data.workspace),r.changingPage=!1,void i.go("dashboard-user-welcome",{});s.show(s.simple().textContent("Error occured while creating your account. please account support").position("top right").hideDelay(1e4))})}()}),!1}alert=$mdDialog.alert({title:"Error",textContent:"Please select a template",ok:"Close"})},e.recall=function(){var t=angular.copy(e.verify1);t.userId=e.userId,r.changingPage=!0,a.post("/registerSendVerify",t).then(function(e){r.changingPage=!1,s.show(s.simple().textContent("You will be called shortly.").position("top right").hideDelay(3e3))})},e.authenticate=function(){var e=n.defer();return o(function(){e.resolve(),o(function(){t.path("/dashboard/home")},600)},1100),e.promise},e.useTemplate=function(t){e.selectedTemplate=t},e.isSelected=function(t){return!(!e.selectedTemplate||t.id!==e.selectedTemplate.id)},e.gotoLogin=function(){r.changingPage=!0,r.scrollToTop(),i.go("login")},a.get("/getCallSystemTemplates").then(function(t){e.templates=t.data,r.changingPage=!1,u.hasData&&(console.log("$stateParams data is ",u),e.token=u.authData,e.userId=u.userId,e.step=2)})}),angular.module("MaterialApp").controller("ResetCtrl",function(e,t,o,n,a,r,i,s,l){r.updateTitle("Reset"),e.triedSubmit=!1,e.isLoading=!1,e.couldNotReset=!1,e.couldNotResetMsg="";var u=t.search().token;e.user={email:"",password:"",confirmPassword:"",token:u},console.log("reset params are ",e.user),e.submit=function(t,o){if(e.triedSubmit=!0,e.user.password===e.user.confirmPassword){if(e.passwordsDontMatch=!1,o.$valid){var n={};return n.email=e.user.email,n.token=e.user.token,n.password=e.user.password,n.password_confirmation=e.user.confirmPassword,e.isLoading=!0,console.log("requesting reset ",n),e.couldNotReset=!1,e.couldNotResetMsg="",void a.post("/reset",n,!0).then(function(t){t.data;e.isLoading=!1,s.show(s.simple().textContent("Password was reset successfully.").position("top right").hideDelay(3e3)),i.go("login",{})}).catch(function(t){console.log("error reply is ",t),e.couldNotReset=!0,e.couldNotResetMsg=t.data.message,e.isLoading=!1})}}else e.passwordsDontMatch=!0}}),angular.module("MaterialApp").controller("SettingsCtrl",function(e,t,o,n,a,r,i,s){r.updateTitle("Settings"),e.triedSubmit=!1,e.user={first_name:"",last_name:"",email:"",password:"",password2:""},e.changeCountry=function(e){console.log("changeCountry ",e)},e.submitSettings=function(t,o){if(e.triedSubmit=!0,o.$valid){var n={};return n.first_name=e.user.first_name,n.last_name=e.user.last_name,n.email=e.user.email,r.isCreateLoading=!0,void a.post("/updateSelf",n).then(function(e){s.show(s.simple().textContent("Updated your info").position("top right").hideDelay(3e3)),r.endIsCreateLoading()})}return!1},e.submitPersonal=function(t,o){if(e.triedSubmit=!0,console.log("submitPersonal ",o),o.$valid){var n={};return n.address_line_1=e.user.address_line_1,n.address_line_2=e.user.address_line_2,n.postal_code=e.user.postal_code,n.state=e.user.state,n.city=e.user.city,n.country=e.user.country,r.isCreateLoading=!0,void a.post("/updateSelf",n).then(function(e){s.show(s.simple().textContent("Updated your info").position("top right").hideDelay(3e3)),r.endIsCreateLoading()})}return!1},e.submitPasswords=function(t,o){if(e.triedSubmit=!0,e.user.password===e.user.password2){if(e.passwordsDontMatch=!1,o.$valid){var n={};return n.password=e.user.password,r.isCreateLoading=!0,void a.post("/updateSelf",n).then(function(e){e.data;s.show(s.simple().textContent("Updated your passwords").position("top right").hideDelay(3e3)),r.endIsCreateLoading()})}return!1}e.passwordsDontMatch=!0},r.isLoading=!0,a.get("/self").then(function(t){e.user=t.data,console.log("user is ",e.user),r.endIsLoading()})}),angular.module("MaterialApp").controller("sidenavCtrl",function(e,t){e.selectedMenu="dashboard",e.collapseVar=0,e.check=function(t){t==e.collapseVar?e.collapseVar=0:e.collapseVar=t},e.multiCheck=function(t){t==e.multiCollapseVar?e.multiCollapseVar=0:e.multiCollapseVar=t}}),angular.module("MaterialApp").controller("TabsDemoCtrl",function(e,t){e.tabs=[{title:"Dynamic Title 1",content:"Dynamic content 1"},{title:"Dynamic Title 2",content:"Dynamic content 2",disabled:!0}],e.alertMe=function(){setTimeout(function(){t.alert("You've selected the alert tab!")})}}),angular.module("MaterialApp").controller("TimepickerDemoCtrl",function(e,t){e.mytime=new Date,e.hstep=1,e.mstep=15,e.options={hstep:[1,2,3],mstep:[1,5,10,15,25,30]},e.ismeridian=!0,e.toggleMode=function(){e.ismeridian=!e.ismeridian},e.update=function(){var t=new Date;t.setHours(14),t.setMinutes(0),e.mytime=t},e.changed=function(){t.log("Time changed to: "+e.mytime)},e.clear=function(){e.mytime=null}}),angular.module("MaterialApp").controller("todoCtrl",function(e){function t(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;o<5;o++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}e.todos=[{text:"Meeting with Nabindar Singh.",done:!1,id:"option1"},{text:"Exercise at 6:pm with Nicholas.",done:!1,id:"option3"},{text:"Avengers Age of Ultron.",done:!1,id:"option4"},{text:"Henna birthday at Mezbaan.",done:!1,id:"option5"}],e.addTodo=function(){e.todos.push({text:e.formTodoText,done:!1,id:t()}),e.formTodoText=""}}),angular.module("MaterialApp").controller("TooltipDemoCtrl",function(e){e.dynamicTooltip="Hello, World!",e.dynamicTooltipText="dynamic",e.htmlTooltip="I've been made <b>bold</b>!"}),angular.module("MaterialApp").controller("VerifiedCallerIdsCtrl",function(e,t,o,n,a,r,i,s,l){function u(e,t,o,n,a){e.$shared=n,e.error=!1,e.errorText="",e.$mdDialog=t,e.data={step1:{number:""},step2:{code:""}},e.step=1,e.postStep1=function(){var t=angular.copy(e.data.step1);o.post("/settings/verifiedCallerids",t).then(function(t){e.step=2})},e.postStep2=function(){var t={code:e.data.step2.code,number:e.data.step1.number};o.post("/settings/verifiedCallerids/confirm",t).then(function(t){t.data.success?(r.show(r.simple().textContent("Number verified").position("top right").hideDelay(3e3)),e.close(),a()):(e.error=!0,e.errorText="The code was invalid please try again.")})},e.close=function(){console.log("closing dialog.."),t.hide()}}s.updateTitle("Verified Caller IDs"),e.numbers=[],e.load=function(){return s.isLoading=!0,l(function(o,n){t.get("/settings/verifiedCallerids").then(function(t){e.numbers=t.data,s.endIsLoading(),o()},function(){n()})})},e.createNumber=function(t){a.show({controller:u,templateUrl:"views/dialogs/add-callerid.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!0,fullscreen:e.customFullscreen,locals:{onCreated:function(){e.load()}}}).then(function(){},function(){})},e.deleteNumber=function(o,n){var i=a.confirm().title("Are you sure you want to delete this number?").textContent("This will permantely remove the caller ID").ariaLabel("Delete extension").targetEvent(o).ok("Yes").cancel("No");a.show(i).then(function(){s.isLoading=!0,t.delete("/settings/verifiedCallerids/"+n.public_id).then(function(){e.load().then(function(){r.show(r.simple().textContent("Number deleted..").position("top right").hideDelay(3e3))})})},function(){})},e.load()}),angular.module("MaterialApp").controller("VerifiedCallerIdsCreateCtrl",function(e,t,o,n,a,r,i,s){s.updateTitle("Verified Caller IDs"),e.values={secret:""},e.ui={showSecret:!1,secretStrength:0},e.triedSubmit=!1,e.generateSecret=function(){e.values.secret=generatePassword()},e.showSecret=function(){e.ui.showSecret=!0},e.hideSecret=function(){e.ui.showSecret=!1},e.submit=function(o){if(console.log("submitting extension form ",arguments),e.triedSubmit=!0,o.$valid){var a={};a.username=e.values.username,a.caller_id=e.values.caller_id,a.secret=e.values.secret;var i={bottom:!1,top:!0,left:!1,right:!0},l=Object.keys(i).filter(function(e){return i[e]}).join(" ");console.log("toastPosStr",l),s.isCreateLoading=!0,t.post("/extension/saveExtension",a).then(function(){console.log("updated extension.."),r.show(r.simple().textContent("Created extension").position("top right").hideDelay(3e3)),n.go("extensions",{}),s.endIsCreateLoading()})}},e.keyupSecret=function(){var t=zxcvbn(e.values.secret);e.ui.secretStrength=(25*t.score).toString()+"%"},i(function(){s.endIsLoading()},0)}),angular.module("MaterialApp").controller("WorkspaceAPISettingsCtrl",function(e,t,o,n,a,r,i,s,l){s.updateTitle("Workspace API Settings"),e.settings={},e.load=function(){return s.isLoading=!0,l(function(o,n){t.get("/getWorkspaceTokens").then(function(t){e.settings=t.data,s.endIsLoading(),o()},function(){n()})})},e.refreshTokens=function(o){var n=a.confirm().title("Are you sure you want to refresh API tokens?").textContent("if you are using these API tokens in any code the code will stop working and you will need to replace the API tokens with the new ones you create").ariaLabel("Refresh tokens").targetEvent(o).ok("Yes").cancel("No");a.show(n).then(function(){s.isLoading=!0,t.get("/refreshWorkspaceTokens").then(function(t){e.load().then(function(){r.show(r.simple().textContent("API tokens recreated").position("top right").hideDelay(3e3))})})})},e.promptCopied=function(){r.show(r.simple().textContent("Copied to clipboard!").position("top right").hideDelay(3e3))},e.load()}),angular.module("MaterialApp").controller("WorkspaceParamCtrl",function(e,t,o,n,a,r,i,s,l){s.updateTitle("Workspace Params"),e.params=[],e.load=function(){return s.isLoading=!0,l(function(o,n){t.get("/workspaceParam/listParams").then(function(t){e.params=t.data,s.endIsLoading(),o()},function(){n()})})},e.saveParams=function(){var o=angular.copy(e.params);t.post("/workspaceParam/saveParams",o).then(function(){r.show(r.simple().textContent("Workspace params saved successfully..").position("top right").hideDelay(3e3))})},e.addParam=function(){e.params.push({key:"",value:""})},e.deleteParam=function(t,o){e.params.splice(t,1)},e.load()}),angular.module("MaterialApp").controller("WorkspaceUserCtrl",function(e,t,o,n,a,r,i,s,l){s.updateTitle("Workspace Users"),e.users=[],e.load=function(){return s.isLoading=!0,l(function(o,n){t.get("/workspaceUser/listUsers").then(function(t){e.users=t.data,s.endIsLoading(),o()},function(){n()})})},e.deleteUser=function(o,n){var i=a.confirm().title("Are you sure you want to remove this user from your workspace ?").textContent("This will permantely remove the user from your workspace").ariaLabel("Delete user").targetEvent(o).ok("Yes").cancel("No");a.show(i).then(function(){s.isLoading=!0,t.delete("/workspaceUser/deleteUser/"+n.public_id).then(function(){e.load().then(function(){r.show(r.simple().textContent("User deleted..").position("top right").hideDelay(3e3))})})},function(){})},e.editUser=function(e,t){console.log("edit usr ",t),s.changeRoute("settings-workspace-users-edit",{userId:t.public_id})},e.createUser=function(){s.changeRoute("settings-workspace-users-create",{})},e.load()}),angular.module("MaterialApp").controller("WorkspaceUserCreateCtrl",function(e,t,o,n,a,r,i,s){s.updateTitle("Create Extension"),e.availableRoles=s.makeDefaultWorkspaceRoles(!0),e.values={user:{first_name:"",last_name:"",email:""},roles:s.makeDefaultWorkspaceRoles()},e.triedSubmit=!1,e.submit=function(o){if(console.log("submitting workspace user form ",arguments),e.triedSubmit=!0,o.$valid){var a={user:angular.copy(e.values.user),roles:angular.copy(e.values.roles)},i={bottom:!1,top:!0,left:!1,right:!0},l=Object.keys(i).filter(function(e){return i[e]}).join(" ");console.log("toastPosStr",l),s.isCreateLoading=!0,t.post("/workspaceUser/addUser",a).then(function(){console.log("added user.."),r.show(r.simple().textContent("Added user to workspace").position("top right").hideDelay(3e3)),n.go("settings-workspace-users",{}),s.endIsCreateLoading()})}},i(function(){s.endIsLoading()},0)}),angular.module("MaterialApp").controller("WorkspaceUserEditCtrl",function(e,t,o,n,a,r,i,s,l){l.updateTitle("Workspace User Edit");var u=l.makeDefaultWorkspaceRoles();e.availableRoles=l.makeDefaultWorkspaceRoles(!0),e.values={user:{first_name:"",last_name:"",email:""},roles:l.makeDefaultWorkspaceRoles()},e.ui={showSecret:!1,secretStrength:0},e.triedSubmit=!1,e.submit=function(o){if(console.log("submitting workspace user form ",arguments),e.triedSubmit=!0,o.$valid){var r={user:angular.copy(e.values.user),roles:angular.copy(e.values.roles)},s={bottom:!1,top:!0,left:!1,right:!0},u=Object.keys(s).filter(function(e){return s[e]}).join(" ");console.log("toastPosStr",u),l.isCreateLoading=!0,t.post("/workspaceUser/updateUser/"+a.userId,r).then(function(){console.log("added user.."),i.show(i.simple().textContent("Added user to workspace").position("top right").hideDelay(3e3)),n.go("settings-workspace-users",{}),l.endIsCreateLoading()})}},t.get("/workspaceUser/userData/"+a.userId).then(function(t){var o=t.data;for(var n in e.values.user.email=o.email,e.values.user.first_name=o.first_name,e.values.user.last_name=o.last_name,u)console.log("checking for role ",n),e.values.roles[n]=o[n];console.log("$scope.values are ",e.values)}),s(function(){l.endIsLoading()},0)});